{"version":3,"sources":["detach/ExponentTools.js"],"names":["async","url","headers","buildPhaseLogger","logger","withFields","buildPhase","requestOptions","replace","let","response","await","_retryPromise","request","err","error","Error","responseBody","body","info","manifest","JSON","parse","e","getManifestAsync","fn","retries","args","length","spawnAsyncQuiet","stdio","cwd","process","options","pipeToLogger","promise","child","streamsKeys","_","isObject","keys","pickBy","identity","streamsToLogs","pick","pipeOutputToLogger","loggerFields","spawnAsyncThrowError","message","spawnAsync","filename","transform","fileString","fs","readFile","newFileString","writeFile","transformFileContentsAsync","inMemoryManifest","locales","undefined","lang","path","Object","entries","s","ErrorCode","INVALID_JSON","stringify","getResolvedLocalesAsync","regex","file","toString","regexFileAsync","startRegex","endRegex","lines","split","filteredLines","inDeleteRange","i","match","push","join","deleteLinesInFileAsync","Request","defaults","resolveWithFullResponse","_getFilesizeInBytes","stats","statSync","fileSizeInBytes","parseSdkMajorVersion","expSdkVersion","Infinity","sdkMajorVersion","versionComponents","map","number","parseInt","saveUrlToPathAsync","Promise","resolve","reject","stream","createWriteStream","on","pipeRequest","pipe","saveImageToPathAsync","projectRoot","pathOrURL","outPath","localPath","existsSync","createReadStream","createSpawner","command","lastArg","last","optionsFromArg","pop","manifestUsesSplashApi","platform","splash","ios","android","rimrafDontThrow","directory","rimraf","sync","warn","isDirectory","dir"],"mappings":"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","file":"../../detach/ExponentTools.js","sourcesContent":["// Copyright 2015-present 650 Industries. All rights reserved.\n\n'use strict';\n\nimport fs from 'fs-extra';\nimport path from 'path';\nimport Request from 'request-promise-native';\n// `request-promise-native` discourages using pipe. Noticed some issues with\n// error handling so when using pipe use the original request lib instead.\nimport pipeRequest from 'request';\nimport rimraf from 'rimraf';\nimport spawnAsyncQuiet from '@expo/spawn-async';\nimport _ from 'lodash';\n\nimport logger, { pipeOutputToLogger } from './Logger';\nimport XDLError from '../XDLError';\nimport ErrorCode from '../ErrorCode';\n\nconst request = Request.defaults({\n  resolveWithFullResponse: true,\n});\n\nfunction _getFilesizeInBytes(path) {\n  let stats = fs.statSync(path);\n  let fileSizeInBytes = stats['size'];\n  return fileSizeInBytes;\n}\n\nfunction parseSdkMajorVersion(expSdkVersion) {\n  // We assume that the unversioned SDK is the latest\n  if (expSdkVersion === 'UNVERSIONED') {\n    return Infinity;\n  }\n\n  let sdkMajorVersion = 0;\n  try {\n    let versionComponents = expSdkVersion.split('.').map(number => parseInt(number, 10));\n    sdkMajorVersion = versionComponents[0];\n  } catch (_) {}\n  return sdkMajorVersion;\n}\n\nfunction saveUrlToPathAsync(url, path) {\n  return new Promise(function(resolve, reject) {\n    let stream = fs.createWriteStream(path);\n    stream.on('close', () => {\n      if (_getFilesizeInBytes(path) < 10) {\n        throw new Error(`{filename} is too small`);\n      }\n      resolve();\n    });\n    stream.on('error', reject);\n    pipeRequest(url).pipe(stream);\n  });\n}\n\nfunction saveImageToPathAsync(projectRoot, pathOrURL, outPath) {\n  const localPath = path.resolve(projectRoot, pathOrURL);\n  return new Promise(function(resolve, reject) {\n    let stream = fs.createWriteStream(outPath);\n    stream.on('close', () => {\n      if (_getFilesizeInBytes(outPath) < 10) {\n        throw new Error(`{filename} is too small`);\n      }\n      resolve();\n    });\n    stream.on('error', reject);\n    if (fs.existsSync(localPath)) {\n      fs.createReadStream(localPath).pipe(stream);\n    } else {\n      pipeRequest(pathOrURL).pipe(stream);\n    }\n  });\n}\n\nasync function getManifestAsync(url, headers) {\n  const buildPhaseLogger = logger.withFields({ buildPhase: 'reading manifest' });\n  const requestOptions = {\n    url: url.replace('exp://', 'http://'),\n    headers,\n  };\n\n  let response;\n  try {\n    response = await _retryPromise(() => request(requestOptions));\n  } catch (err) {\n    buildPhaseLogger.error(err);\n    throw new Error('Failed to fetch manifest from www');\n  }\n  const responseBody = response.body;\n  buildPhaseLogger.info('Using manifest:', responseBody);\n  let manifest;\n  try {\n    manifest = JSON.parse(responseBody);\n  } catch (e) {\n    throw new Error(`Unable to parse manifest: ${e}`);\n  }\n\n  return manifest;\n}\n\nasync function _retryPromise(fn, retries = 5) {\n  try {\n    return await fn();\n  } catch (err) {\n    if (retries-- > 0) {\n      return await _retryPromise(fn, retries);\n    } else {\n      throw err;\n    }\n  }\n}\n\nasync function spawnAsyncThrowError(...args) {\n  if (args.length === 2) {\n    return spawnAsyncQuiet(args[0], args[1], {\n      stdio: 'inherit',\n      cwd: process.cwd(),\n    });\n  } else {\n    const options = args[2];\n    const { pipeToLogger } = options;\n    if (pipeToLogger) {\n      options.stdio = 'pipe';\n      options.cwd = options.cwd || process.cwd();\n    }\n    const promise = spawnAsyncQuiet(...args);\n    if (pipeToLogger && promise.child) {\n      const streamsKeys = _.isObject(pipeToLogger)\n        ? _.keys(_.pickBy(pipeToLogger, _.identity))\n        : ['stdout', 'stderr'];\n      const streamsToLogs = _.pick(promise.child, streamsKeys);\n      pipeOutputToLogger(streamsToLogs, options.loggerFields, options);\n    }\n    return promise;\n  }\n}\n\nasync function spawnAsync(...args) {\n  try {\n    return await spawnAsyncThrowError(...args);\n  } catch (e) {\n    logger.error(e.message);\n  }\n}\n\nfunction createSpawner(buildPhase, logger) {\n  return (command, ...args) => {\n    const lastArg = _.last(args);\n    const optionsFromArg = _.isObject(lastArg) ? args.pop() : {};\n\n    const options = { ...optionsFromArg, pipeToLogger: true };\n    if (buildPhase) {\n      options.loggerFields = options.loggerFields ? options.loggerFields : {};\n      options.loggerFields = { ...options.loggerFields, buildPhase };\n    }\n\n    if (logger) {\n      logger.info('Executing command:', command, ...args);\n    }\n    return spawnAsyncThrowError(command, args, options);\n  };\n}\n\nasync function transformFileContentsAsync(filename, transform) {\n  let fileString = await fs.readFile(filename, 'utf8');\n  let newFileString = transform(fileString);\n  if (newFileString !== null) {\n    await fs.writeFile(filename, newFileString);\n  }\n}\n\nfunction manifestUsesSplashApi(manifest, platform) {\n  if (platform === 'ios') {\n    return manifest.splash || (manifest.ios && manifest.ios.splash);\n  }\n  if (platform === 'android') {\n    return manifest.splash || (manifest.android && manifest.android.splash);\n  }\n  return false;\n}\n\nfunction rimrafDontThrow(directory) {\n  try {\n    rimraf.sync(directory);\n  } catch (e) {\n    logger.warn(\n      `There was an issue cleaning up, but your project should still work. You may need to manually remove ${directory}. (${e})`\n    );\n  }\n}\n\nfunction isDirectory(dir) {\n  try {\n    if (fs.statSync(dir).isDirectory()) {\n      return true;\n    }\n\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\nasync function getResolvedLocalesAsync(inMemoryManifest) {\n  const locales = {};\n  if (inMemoryManifest.locales !== undefined) {\n    for (const [lang, path] of Object.entries(inMemoryManifest.locales)) {\n      const s = await fs.readFile(path, 'utf8');\n      try {\n        locales[lang] = JSON.parse(s);\n      } catch (e) {\n        throw new XDLError(ErrorCode.INVALID_JSON, JSON.stringify(e));\n      }\n    }\n  }\n  return locales;\n}\n\nasync function regexFileAsync(regex, replace, filename) {\n  let file = await fs.readFile(filename);\n  let fileString = file.toString();\n  await fs.writeFile(filename, fileString.replace(regex, replace));\n}\n\n// Matches sed /d behavior\nasync function deleteLinesInFileAsync(startRegex, endRegex, filename) {\n  let file = await fs.readFile(filename);\n  let fileString = file.toString();\n  let lines = fileString.split(/\\r?\\n/);\n  let filteredLines = [];\n  let inDeleteRange = false;\n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].match(startRegex)) {\n      inDeleteRange = true;\n    }\n\n    if (!inDeleteRange) {\n      filteredLines.push(lines[i]);\n    }\n\n    if (inDeleteRange && lines[i].match(endRegex)) {\n      inDeleteRange = false;\n    }\n  }\n  await fs.writeFile(filename, filteredLines.join('\\n'));\n}\n\nexport {\n  isDirectory,\n  parseSdkMajorVersion,\n  saveUrlToPathAsync,\n  saveImageToPathAsync,\n  getManifestAsync,\n  rimrafDontThrow,\n  spawnAsyncThrowError,\n  spawnAsync,\n  transformFileContentsAsync,\n  manifestUsesSplashApi,\n  getResolvedLocalesAsync,\n  regexFileAsync,\n  deleteLinesInFileAsync,\n  createSpawner,\n};\n"],"sourceRoot":"/xdl@51.3.1/src"}