{"version":3,"sources":["detach/IosNSBundle.js"],"names":["async","context","backupPath","await","IosPlist","cleanBackupAsync","type","projectName","IosWorkspace","getPaths","_cleanPropertyListBackupsAsync","manifest","supportingDirectory","manifestFilename","bundleFilename","bundleUrl","fs","writeFile","path","join","JSON","stringify","saveUrlToPathAsync","_preloadManifestAndBundleAsync","let","sdkVersionSupported","getNewestSdkVersionSupportedAsync","parseSdkMajorVersion","logger","info","kernelManifest","getManifestAsync","KERNEL_URL","Accept","_maybeLegacyPreloadKernelManifestAndBundleAsync","exp","data","keysToFlag","ios","usesIcloudStorage","push","associatedDomains","length","forEach","key","entitlementsFilename","appleTeamId","build","existsSync","createBlankAsync","result","modifyAsync","entitlements","configuration","bundleIdentifier","hasOwnProperty","_configureEntitlementsAsync","config","privateConfig","_getPrivateConfig","infoPlist","usageDescriptionKeysConfigured","extraConfig","_isAppleUsageDescriptionKey","CFBundleIdentifier","Error","CFBundleName","name","CFBundleDisplayName","linkingSchemes","scheme","facebookScheme","startsWith","googleSignIn","reservedClientId","CFBundleURLTypes","CFBundleURLSchemes","CFBundleURLName","facebookAppId","FacebookAppID","queriesSchemes","LSApplicationQueriesSchemes","concat","facebookDisplayName","FacebookDisplayName","usesNonExemptEncryption","ITSAppUsesNonExemptEncryption","googleMapsApiKey","GMSApiKey","version","buildNumber","CFBundleShortVersionString","CFBundleVersion","Fabric","APIKey","fabric","apiKey","DEFAULT_FABRIC_KEY","Kits","KitInfo","KitName","branch","branch_key","live","permissionsAppName","replace","UIDeviceFamily","supportsTablet","isTabletOnly","_configureInfoPlistForLocalDevelopment","_logDeveloperInfoForLocalDevelopment","_configureInfoPlistAsync","buildPhaseLogger","withFields","buildPhase","shellPlist","sdkVersion","isShell","manifestUrl","published","url","releaseChannel","testEnvironment","permissions","isManifestVerificationBypassed","areRemoteUpdatesEnabled","isRemoteJSEnabled","updates","enabled","manifestUsesSplashApi","isSplashScreenDisabled","_configureShellPlistAsync","intermediatesDirectory","iosProjectDirectory","rimrafAsync","IosLaunchScreen","configureLaunchAssetsAsync","IosLocalization","writeLocalizationResourcesAsync","iconPath","IosIcons","createAndWriteIconsToPathAsync","AssetBundle","bundleAsync","bundledAssets","e","IosAssetArchive","buildAssetArchiveAsync","Promise","all","configureAsync","promisify","isDetached","detach","usageKeysConfigured","indexOf"],"mappings":"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","file":"../../detach/IosNSBundle.js","sourcesContent":["/**\n * @flow\n */\n\nimport fs from 'fs-extra';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport promisify from 'util.promisify';\n\nimport {\n  getManifestAsync,\n  saveUrlToPathAsync,\n  manifestUsesSplashApi,\n  parseSdkMajorVersion,\n} from './ExponentTools';\nimport * as IosAssetArchive from './IosAssetArchive';\nimport * as AssetBundle from './AssetBundle';\nimport * as IosIcons from './IosIcons';\nimport * as IosPlist from './IosPlist';\nimport * as IosLaunchScreen from './IosLaunchScreen';\nimport * as IosWorkspace from './IosWorkspace';\nimport StandaloneContext from './StandaloneContext';\nimport * as IosLocalization from './IosLocalization';\nimport logger from './Logger';\n\nconst rimrafAsync = promisify(rimraf);\n\n// TODO: move this somewhere else. this is duplicated in universe/exponent/template-files/keys,\n// but xdl doesn't have access to that.\nconst DEFAULT_FABRIC_KEY = '81130e95ea13cd7ed9a4f455e96214902c721c99';\nconst KERNEL_URL = 'https://expo.io/@exponent/home';\n\nfunction _configureInfoPlistForLocalDevelopment(config: any, exp: any) {\n  // add detached scheme\n  if (exp.isDetached && exp.detach.scheme) {\n    if (!config.CFBundleURLTypes) {\n      config.CFBundleURLTypes = [\n        {\n          CFBundleURLSchemes: [],\n        },\n      ];\n    }\n    config.CFBundleURLTypes[0].CFBundleURLSchemes.push(exp.detach.scheme);\n  }\n  // for local dev, don't specify device family here\n  if (config.UIDeviceFamily) {\n    delete config.UIDeviceFamily;\n  }\n  return config;\n}\n\n/**\n *  Prints warnings or info about the configured environment for local development.\n */\nfunction _logDeveloperInfoForLocalDevelopment(infoPlist: any) {\n  // warn about *UsageDescription changes\n  let usageKeysConfigured = [];\n  for (let key in infoPlist) {\n    if (infoPlist.hasOwnProperty(key) && key.indexOf('UsageDescription') !== -1) {\n      usageKeysConfigured.push(key);\n    }\n  }\n  if (usageKeysConfigured.length) {\n    logger.info('We added some permissions keys to `Info.plist` in your detached iOS project:');\n    usageKeysConfigured.forEach(key => {\n      logger.info(`  ${key}`);\n    });\n    logger.info(\n      'You may want to revise them to include language appropriate to your project. You can also remove them if your app will never use the corresponding API. See the Apple docs for these keys.'\n    );\n  }\n}\n\nasync function _cleanPropertyListBackupsAsync(context: StandaloneContext, backupPath: string) {\n  await IosPlist.cleanBackupAsync(backupPath, 'EXShell', false);\n  await IosPlist.cleanBackupAsync(backupPath, 'Info', false);\n  // TODO: support this in user contexts as well\n  if (context.type === 'service') {\n    const { projectName } = IosWorkspace.getPaths(context);\n    await IosPlist.cleanBackupAsync(backupPath, `${projectName}.entitlements`, false);\n  }\n}\n\n/**\n * Write the manifest and JS bundle to the NSBundle.\n */\nasync function _preloadManifestAndBundleAsync(\n  manifest: any,\n  supportingDirectory: string,\n  manifestFilename: string,\n  bundleFilename: string\n) {\n  const bundleUrl = manifest.bundleUrl;\n  await fs.writeFile(path.join(supportingDirectory, manifestFilename), JSON.stringify(manifest));\n  await saveUrlToPathAsync(bundleUrl, path.join(supportingDirectory, bundleFilename));\n}\n\n/**\n *  This method only makes sense when operating on a context with sdk version < 26.\n */\nasync function _maybeLegacyPreloadKernelManifestAndBundleAsync(\n  context: StandaloneContext,\n  manifestFilename: string,\n  bundleFilename: string\n) {\n  const { supportingDirectory } = IosWorkspace.getPaths(context);\n  let sdkVersionSupported = await IosWorkspace.getNewestSdkVersionSupportedAsync(context);\n\n  if (parseSdkMajorVersion(sdkVersionSupported) < 26) {\n    logger.info('Preloading Expo kernel JS...');\n    const kernelManifest = await getManifestAsync(KERNEL_URL, {\n      'Exponent-SDK-Version': sdkVersionSupported,\n      'Exponent-Platform': 'ios',\n      Accept: 'application/expo+json,application/json',\n    });\n    return _preloadManifestAndBundleAsync(\n      kernelManifest,\n      supportingDirectory,\n      manifestFilename,\n      bundleFilename\n    );\n  }\n}\n\n/**\n * Configure a standalone entitlements file.\n */\nasync function _configureEntitlementsAsync(context: StandaloneContext) {\n  if (context.type === 'user') {\n    // don't modify .entitlements, print info/instructions\n    const exp = context.data.exp;\n    logger.info(\n      'Your iOS ExpoKit project will not contain an .entitlements file by default. If you need specific Apple entitlements, enable them manually via Xcode or the Apple Developer website.'\n    );\n    let keysToFlag = [];\n    if (exp.ios && exp.ios.usesIcloudStorage) {\n      keysToFlag.push('ios.usesIcloudStorage');\n    }\n    if (exp.ios && exp.ios.associatedDomains) {\n      keysToFlag.push('ios.associatedDomains');\n    }\n    if (keysToFlag.length) {\n      logger.info('We noticed the following keys in your project which may require entitlements:');\n      keysToFlag.forEach(key => {\n        logger.info(`  ${key}`);\n      });\n    }\n    return {};\n  } else {\n    // modify the .entitlements file\n    const { projectName, supportingDirectory } = IosWorkspace.getPaths(context);\n    const manifest = context.data.manifest;\n    const entitlementsFilename = `${projectName}.entitlements`;\n    const appleTeamId = context.build.ios.appleTeamId;\n    if (!fs.existsSync(path.join(supportingDirectory, entitlementsFilename))) {\n      await IosPlist.createBlankAsync(supportingDirectory, entitlementsFilename);\n    }\n    const result = IosPlist.modifyAsync(supportingDirectory, entitlementsFilename, entitlements => {\n      // push notif entitlement changes based on build configuration\n      entitlements['aps-environment'] =\n        context.build.configuration === 'Release' ? 'production' : 'development';\n\n      // remove iCloud-specific entitlements if the developer isn't using iCloud Storage with DocumentPicker\n      if (manifest.ios && manifest.ios.usesIcloudStorage && appleTeamId) {\n        entitlements['com.apple.developer.icloud-container-identifiers'] = [\n          'iCloud.' + manifest.ios.bundleIdentifier,\n        ];\n        entitlements['com.apple.developer.ubiquity-container-identifiers'] = [\n          'iCloud.' + manifest.ios.bundleIdentifier,\n        ];\n        entitlements['com.apple.developer.ubiquity-kvstore-identifier'] =\n          appleTeamId + '.' + manifest.ios.bundleIdentifier;\n        entitlements['com.apple.developer.icloud-services'] = ['CloudDocuments'];\n      } else {\n        [\n          'com.apple.developer.icloud-container-identifiers',\n          'com.apple.developer.icloud-services',\n          'com.apple.developer.ubiquity-container-identifiers',\n          'com.apple.developer.ubiquity-kvstore-identifier',\n        ].forEach(key => {\n          if (entitlements.hasOwnProperty(key)) {\n            delete entitlements[key];\n          }\n        });\n      }\n\n      // Add app associated domains remove exp-specific ones.\n      if (manifest.ios && manifest.ios.associatedDomains) {\n        entitlements['com.apple.developer.associated-domains'] = manifest.ios.associatedDomains;\n      } else if (entitlements.hasOwnProperty('com.apple.developer.associated-domains')) {\n        delete entitlements['com.apple.developer.associated-domains'];\n      }\n\n      // for now, remove any merchant ID in shell apps\n      // (TODO: better plan for payments)\n      delete entitlements['com.apple.developer.in-app-payments'];\n\n      return entitlements;\n    });\n    return result;\n  }\n}\n\n/**\n *  Resolve the private config for a project.\n *  For standalone apps, this is copied into a separate context field context.data.privateConfig\n *  by the turtle builder. For a local project, this is available in app.json under ios.config.\n */\nfunction _getPrivateConfig(context: StandaloneContext): any {\n  let privateConfig;\n  if (context.type === 'service') {\n    privateConfig = context.data.privateConfig;\n  } else if (context.type === 'user') {\n    const exp = context.data.exp;\n    if (exp && exp.ios) {\n      privateConfig = exp.ios.config;\n    }\n  }\n  return privateConfig;\n}\n\nfunction _isAppleUsageDescriptionKey(key: string): boolean {\n  return key.indexOf('UsageDescription') !== -1;\n}\n\n/**\n * Configure an iOS Info.plist for a standalone app.\n */\nasync function _configureInfoPlistAsync(context: StandaloneContext) {\n  const { supportingDirectory } = IosWorkspace.getPaths(context);\n  const config = context.config;\n  const privateConfig = _getPrivateConfig(context);\n\n  let result = await IosPlist.modifyAsync(supportingDirectory, 'Info', infoPlist => {\n    // make sure this happens first:\n    // apply any custom information from ios.infoPlist prior to all other exponent config\n    let usageDescriptionKeysConfigured = {};\n    if (config.ios && config.ios.infoPlist) {\n      let extraConfig = config.ios.infoPlist;\n      for (let key in extraConfig) {\n        if (extraConfig.hasOwnProperty(key)) {\n          infoPlist[key] = extraConfig[key];\n\n          // if the user provides *UsageDescription keys, don't override them later.\n          if (_isAppleUsageDescriptionKey(key)) {\n            usageDescriptionKeysConfigured[key] = true;\n          }\n        }\n      }\n    }\n\n    // bundle id\n    infoPlist.CFBundleIdentifier =\n      config.ios && config.ios.bundleIdentifier ? config.ios.bundleIdentifier : null;\n    if (!infoPlist.CFBundleIdentifier) {\n      throw new Error(`Cannot configure an iOS app with no bundle identifier.`);\n    }\n\n    // app name\n    infoPlist.CFBundleName = config.name;\n    infoPlist.CFBundleDisplayName = config.name;\n\n    // determine app linking schemes\n    let linkingSchemes = config.scheme ? [config.scheme] : [];\n    if (config.facebookScheme && config.facebookScheme.startsWith('fb')) {\n      linkingSchemes.push(config.facebookScheme);\n    }\n\n    if (\n      privateConfig &&\n      privateConfig.googleSignIn &&\n      privateConfig.googleSignIn.reservedClientId\n    ) {\n      linkingSchemes.push(privateConfig.googleSignIn.reservedClientId);\n    }\n\n    // remove exp scheme, add app scheme(s)\n    infoPlist.CFBundleURLTypes = [\n      {\n        CFBundleURLSchemes: linkingSchemes,\n      },\n      {\n        // Add the generic oauth redirect, it's important that it has the name\n        // 'OAuthRedirect' so we can find it in app code.\n        CFBundleURLName: 'OAuthRedirect',\n        CFBundleURLSchemes: [infoPlist.CFBundleIdentifier],\n      },\n    ];\n\n    // add or remove other facebook config\n    if (config.facebookAppId) {\n      infoPlist.FacebookAppID = config.facebookAppId;\n      let queriesSchemes = infoPlist.LSApplicationQueriesSchemes || [];\n      queriesSchemes = queriesSchemes.concat([\n        'fbapi',\n        'fb-messenger-api',\n        'fbauth2',\n        'fbshareextension',\n      ]);\n      infoPlist.LSApplicationQueriesSchemes = queriesSchemes;\n    } else {\n      delete infoPlist['FacebookAppID'];\n    }\n    if (config.facebookDisplayName) {\n      infoPlist.FacebookDisplayName = config.facebookDisplayName;\n    } else {\n      delete infoPlist['FacebookDisplayName'];\n    }\n\n    // set ITSAppUsesNonExemptEncryption to let people skip manually\n    // entering it in iTunes Connect\n    if (\n      privateConfig &&\n      privateConfig.hasOwnProperty('usesNonExemptEncryption') &&\n      privateConfig.usesNonExemptEncryption === false\n    ) {\n      infoPlist.ITSAppUsesNonExemptEncryption = false;\n    }\n\n    // google maps api key\n    if (privateConfig && privateConfig.googleMapsApiKey) {\n      infoPlist.GMSApiKey = privateConfig.googleMapsApiKey;\n    }\n\n    // use version from manifest\n    let version = config.version ? config.version : '0.0.0';\n    let buildNumber = config.ios && config.ios.buildNumber ? config.ios.buildNumber : '1';\n    infoPlist.CFBundleShortVersionString = version;\n    infoPlist.CFBundleVersion = buildNumber;\n\n    infoPlist.Fabric = {\n      APIKey:\n        (privateConfig && privateConfig.fabric && privateConfig.fabric.apiKey) ||\n        DEFAULT_FABRIC_KEY,\n      Kits: [\n        {\n          KitInfo: {},\n          KitName: 'Crashlytics',\n        },\n      ],\n    };\n\n    if (privateConfig && privateConfig.branch) {\n      infoPlist.branch_key = {\n        live: privateConfig.branch.apiKey,\n      };\n    }\n\n    let permissionsAppName = config.name ? config.name : 'this app';\n    for (let key in infoPlist) {\n      if (\n        infoPlist.hasOwnProperty(key) &&\n        _isAppleUsageDescriptionKey(key) &&\n        !usageDescriptionKeysConfigured.hasOwnProperty(key)\n      ) {\n        infoPlist[key] = infoPlist[key].replace('Expo experiences', permissionsAppName);\n      }\n    }\n\n    // 1 is iPhone, 2 is iPad\n    infoPlist.UIDeviceFamily = config.ios && config.ios.supportsTablet ? [1, 2] : [1];\n\n    // allow iPad-only\n    if (config.ios && config.ios.isTabletOnly) {\n      infoPlist.UIDeviceFamily = [2];\n    }\n\n    // context-specific plist changes\n    if (context.type === 'user') {\n      infoPlist = _configureInfoPlistForLocalDevelopment(infoPlist, context.data.exp);\n      _logDeveloperInfoForLocalDevelopment(infoPlist);\n    }\n\n    return infoPlist;\n  });\n  return result;\n}\n\n/**\n *  Configure EXShell.plist for a standalone app.\n */\nasync function _configureShellPlistAsync(context: StandaloneContext) {\n  const { supportingDirectory } = IosWorkspace.getPaths(context);\n  const config = context.config;\n  const buildPhaseLogger = logger.withFields({ buildPhase: 'configuring NSBundle' });\n\n  await IosPlist.modifyAsync(supportingDirectory, 'EXShell', shellPlist => {\n    // older SDK versions rely on `isShell` flag in xdl\n    if (parseSdkMajorVersion(config.sdkVersion) < 28) {\n      shellPlist.isShell = true;\n    }\n    shellPlist.manifestUrl = context.published.url;\n    shellPlist.releaseChannel = context.published.releaseChannel;\n    if (context.data.testEnvironment) {\n      shellPlist.testEnvironment = context.data.testEnvironment;\n    }\n    if (config.ios && config.ios.permissions) {\n      shellPlist.permissions = config.ios.permissions;\n    }\n    if (context.type == 'user') {\n      // disable manifest verification on detached apps until\n      // the developer adds the correct entitlements to their bundle id.\n      shellPlist.isManifestVerificationBypassed = true;\n    }\n    if (config.ios && config.ios.hasOwnProperty('isRemoteJSEnabled')) {\n      // deprecated, overridden by updates.enabled if that exists\n      shellPlist.areRemoteUpdatesEnabled = config.ios.isRemoteJSEnabled;\n    }\n    if (config.updates && config.updates.hasOwnProperty('enabled')) {\n      // enable/disable code push if the developer provided specific behavior\n      shellPlist.areRemoteUpdatesEnabled = config.updates.enabled;\n    }\n    if (!manifestUsesSplashApi(config, 'ios') && parseSdkMajorVersion(config.sdkVersion) < 28) {\n      // for people still using the old loading api, hide the native splash screen.\n      // we can remove this code eventually.\n      shellPlist.isSplashScreenDisabled = true;\n    }\n\n    buildPhaseLogger.info('Using standalone config:', shellPlist);\n    return shellPlist;\n  });\n}\n\nasync function configureAsync(context: StandaloneContext) {\n  const buildPhaseLogger = logger.withFields({ buildPhase: 'configuring NSBundle' });\n\n  let {\n    intermediatesDirectory,\n    iosProjectDirectory,\n    projectName,\n    supportingDirectory,\n  } = IosWorkspace.getPaths(context);\n  if (!context.published.url) {\n    throw new Error(`Can't configure a NSBundle without a published url.`);\n  }\n\n  // ensure the intermediates directory is clean of any prior build's artifacts, in the event we\n  // share directories across builds\n  await rimrafAsync(intermediatesDirectory);\n\n  try {\n    // common configuration for all contexts\n    buildPhaseLogger.info(`Modifying NSBundle configuration at ${supportingDirectory}...`);\n    await _configureInfoPlistAsync(context);\n    await _configureShellPlistAsync(context);\n    await _configureEntitlementsAsync(context);\n    await IosLaunchScreen.configureLaunchAssetsAsync(context, intermediatesDirectory);\n    await IosLocalization.writeLocalizationResourcesAsync({\n      supportingDirectory,\n      context,\n    });\n\n    if (context.type === 'user') {\n      const iconPath = path.join(\n        iosProjectDirectory,\n        projectName,\n        'Assets.xcassets',\n        'AppIcon.appiconset'\n      );\n      await IosIcons.createAndWriteIconsToPathAsync(context, iconPath);\n    } else if (context.type === 'service') {\n      buildPhaseLogger.info('Bundling assets...');\n      try {\n        await AssetBundle.bundleAsync(\n          context.data.manifest.bundledAssets,\n          supportingDirectory,\n          context.data.manifest.sdkVersion === '24.0.0'\n        );\n      } catch (e) {\n        throw new Error(`Asset bundling failed: ${e}`);\n      }\n      buildPhaseLogger.info('Compiling resources...');\n      await IosAssetArchive.buildAssetArchiveAsync(\n        context,\n        supportingDirectory,\n        intermediatesDirectory\n      );\n      await _preloadManifestAndBundleAsync(\n        context.data.manifest,\n        supportingDirectory,\n        'shell-app-manifest.json',\n        'shell-app.bundle'\n      );\n    }\n\n    await _maybeLegacyPreloadKernelManifestAndBundleAsync(\n      context,\n      'kernel-manifest.json',\n      'kernel.ios.bundle'\n    );\n  } finally {\n    buildPhaseLogger.info('Cleaning up iOS...');\n    await Promise.all([\n      _cleanPropertyListBackupsAsync(context, supportingDirectory),\n      rimrafAsync(intermediatesDirectory),\n    ]);\n  }\n}\n\nexport { configureAsync };\n"],"sourceRoot":"/xdl@51.3.1/src"}